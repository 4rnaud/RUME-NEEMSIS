*-------------------------
*Arnaud NATAL
*arnaud.natal@u-bordeaux.fr
*-----
*Family composition
*-----
*-------------------------

********** Clear
clear all
macro drop _all

********** Path to working directory directory
global directory = "C:\Users\Arnaud\Documents\MEGA\Data\NEEMSIS-Construction"
cd"$directory"

********** Database names
global data = "NEEMSIS1-HH"

********** Scheme
set scheme plotplain_v2
grstyle init
grstyle set plain, box nogrid

********** Deflate
*https://data.worldbank.org/indicator/FP.CPI.TOTL?locations=IN
*(100/158) if year==2016
*(100/184) if year==2020









****************************************
* Relationshiptohead
****************************************
use"NEEMSIS1-HH", clear


*** To keep
keep HHID2016 INDID2016 name age sex relationshiptohead livinghome maritalstatus
fre livinghome
drop if livinghome==3
drop if livinghome==4
drop livinghome


*** Id panel
tostring INDID2016, replace
merge m:m HHID2016 using "keypanel-HH_wide", keepusing(HHID_panel)
keep if _merge==3
drop _merge
merge m:m HHID_panel INDID2016 using "keypanel-Indiv_wide", keepusing(INDID_panel)
keep if _merge==3
drop _merge
order HHID_panel INDID_panel HHID2016 INDID2016
destring INDID2016, replace




	* 2.1 Checking for potential miscoding * 
	ta relationshiptohead sex
	* It seems that there are some miscoding between relationshiptohead and sex:
	// 7 wives who are males
	// 1 father who is a female
	// 5 sons who are females
	// 3 daughters who are males
	// 3 daughters-in-law who are males
	// 3 grandmothers who are males * 
		
	** Which are the households concerned? **
	ta relationshiptohead sex, nolabel 
	// Wife & male 
	codebook HHID_panel if relationshiptohead==2 & sex==1
	*ELA36 KUV14 MAN43 MANAM50 MANAM9 NAT36 ORA7*
		
	// Father & female 
	codebook HHID_panel if relationshiptohead==4 & sex==2
	*NAT27*
		
	// Son & female 
	codebook HHID_panel if relationshiptohead==5 & sex==2
	*ELA13 KAR49 KAR8 NAT42 ORA13*
		
	// Daughter & male 
	codebook HHID_panel if relationshiptohead==6 & sex==1
	*KAR39 KOR30 ORA36*
		
	// Daughter-in-law & male 
	codebook HHID_panel if relationshiptohead==8 & sex==1
	*KAR45 MANAM50 ORA26*
		
	// Grandmother & male 
	codebook HHID_panel if relationshiptohead==16 & sex==1
	*KAR18 KUV20 ORA42*
		
		
	* 2.2 Keeping households of interest *
	**ELA36 KUV14 MAN43 MANAM50 MANAM9 NAT36 ORA7 NAT27 ELA13 KAR49 KAR8 NAT42 ORA13 KAR39 KOR30 ORA36 KAR45 MANAM50 ORA26 KAR18 KUV20 ORA42**
	keep if HHID_panel=="ELA36" | HHID_panel=="KUV14" | HHID_panel=="MAN43" | HHID_panel=="MANAM50" | HHID_panel=="MANAM9" | HHID_panel=="NAT36" | HHID_panel=="ORA7" | HHID_panel=="NAT27" | HHID_panel=="ELA13" | HHID_panel=="KAR49" | HHID_panel=="KAR8" | HHID_panel=="NAT42" | HHID_panel=="ORA13" | HHID_panel=="KAR39" | HHID_panel=="KOR30" | HHID_panel=="ORA36" | HHID_panel=="KAR45" | HHID_panel=="MANAM50" | HHID_panel=="ORA26" | HHID_panel=="KAR18" | HHID_panel=="KUV20" | HHID_panel=="ORA42"
	
	* 2.3 Keeping individuals of interest * 
		* 2.3.1 Targeting individuals of interest *
		// Wife & male 
		preserve 
		keep if HHID_panel=="ELA36" | HHID_panel=="KUV14" | HHID_panel=="MAN43" | HHID_panel=="MANAM50" | HHID_panel=="MANAM9" | HHID_panel=="NAT36" | HHID_panel=="ORA7"
		sort HHID_panel
		list HHID_panel INDID_panel if relationshiptohead==2 & sex==1
		* Ind_1: ELA36 KUV14 MAN43 MANAM50 MANAM9 
		// Ind_2: NAT36 ORA7 *
		restore 
		
		// Father & female 
		preserve 
		keep if HHID_panel=="NAT27" 
		sort HHID_panel
		list HHID_panel INDID_panel if relationshiptohead==4 & sex==2
		* Ind_3: NAT27 * 
		restore 
		
		// Son & female 
		preserve 
		keep if HHID_panel=="ELA13" | HHID_panel=="KAR49" | HHID_panel=="KAR8" | HHID_panel=="NAT42" | HHID_panel=="ORA13"
		sort HHID_panel
		list HHID_panel INDID_panel if relationshiptohead==5 & sex==2
		* Ind_5: ELA13 KAR8
		// Ind_7: KAR49
		// Ind_4: NAT42
		// Ind_2: ORA13 * 
		restore 
		
		// Daughter & male 
		preserve 
		keep if HHID_panel=="KAR39" | HHID_panel=="KOR30" | HHID_panel=="ORA36"
		sort HHID_panel
		list HHID_panel INDID_panel if relationshiptohead==6 & sex==1
		* Ind_4: KAR39 ORA36 
		// Ind_5: KOR30 *
		restore 
		
		// Daughter-in-law & male 
		preserve 
		keep if HHID_panel=="KAR45" | HHID_panel=="MANAM50" | HHID_panel=="ORA26"
		sort HHID_panel
		list HHID_panel INDID_panel if relationshiptohead==8 & sex==1
		* Ind_6: KAR45 MANAM50 
		// Ind_9: ORA26 *
		restore 
		
		// Grandmother & male 
		preserve 
		keep if HHID_panel=="KAR18" | HHID_panel=="KUV20" | HHID_panel=="ORA42"
		sort HHID_panel
		list HHID_panel INDID_panel if relationshiptohead==16 & sex==1
		* Ind_3: KAR18 ORA42 
		// Ind_1: KUV20 *
		restore 
		
		* 2.3.2 Keeping only these individuals *
		**Ind_1: KUV14 MANAM50 ELA36 MANAM9 MAN43 KUV20**
		**Ind_2: ORA7 NAT36 ORA13**
		**Ind_3: NAT27 ORA42 KAR18**
		**Ind_4: NAT42 ORA36 KAR39**
		**Ind_5: ELA13 KAR8 KOR30**
		**Ind_6: KAR45 MANAM50**
		**Ind_7: KAR49**
		**Ind_9: ORA26** 
		keep if (HHID_panel=="KUV14" & INDID_panel=="Ind_1") | (HHID_panel=="MANAM50" & INDID_panel=="Ind_1") | (HHID_panel=="ELA36" & INDID_panel=="Ind_1") | (HHID_panel=="MANAM9" & INDID_panel=="Ind_1") | (HHID_panel=="MAN43" & INDID_panel=="Ind_1") | (HHID_panel=="KUV20" & INDID_panel=="Ind_1") | (HHID_panel=="ORA7" & INDID_panel=="Ind_2") | (HHID_panel=="NAT36" & INDID_panel=="Ind_2") | (HHID_panel=="ORA13" & INDID_panel=="Ind_2") | (HHID_panel=="NAT27" & INDID_panel=="Ind_3") | (HHID_panel=="ORA42" & INDID_panel=="Ind_3") | (HHID_panel=="KAR18" & INDID_panel=="Ind_3") | (HHID_panel=="NAT42" & INDID_panel=="Ind_4") | (HHID_panel=="ORA36" & INDID_panel=="Ind_4") | (HHID_panel=="KAR39" & INDID_panel=="Ind_4") | (HHID_panel=="ELA13" & INDID_panel=="Ind_5") | (HHID_panel=="KAR8" & INDID_panel=="Ind_5") | (HHID_panel=="KOR30" & INDID_panel=="Ind_5") | (HHID_panel=="KAR45" & INDID_panel=="Ind_6") | (HHID_panel=="MANAM50" & INDID_panel=="Ind_6") | (HHID_panel=="KAR49" & INDID_panel=="Ind_7") | (HHID_panel=="ORA26" & INDID_panel=="Ind_9")
	
	* 2.4 Keeping variables of interest *
	keep HHID_panel INDID_panel sex relationshiptohead name
	rename sex sex_NEEMSIS1, replace
	rename relationshiptohead relationshiptohead_NEEMSIS1, replace
	rename name name_NEEMSIS1, replace 
	

save "C:\Users\disantolo\OneDrive - Université Paris-Dauphine\Thèse\Chpt2\Databases\NEEMSIS1-Sex&Relationship.dta", replace






save"outcomes\NEEMSIS1-relationshiptohead", replace
****************************************
* END
